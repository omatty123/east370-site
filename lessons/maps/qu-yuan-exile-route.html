<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>屈原流亡路線 | Qu Yuan's Exile Route (278 BCE)</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --ink: #1a1a1a;
            --ink-light: #4a4a4a;
            --ink-faint: #8a8a8a;
            --paper: #fafaf8;
            --paper-dark: #f0ede8;
            --gold: #b8860b;
            --gold-light: #daa520;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            background: var(--paper);
            font-family: 'Inter', -apple-system, sans-serif;
        }

        /* Breadcrumb */
        .breadcrumb {
            background: var(--ink);
            padding: 0.6rem 1.5rem;
        }

        .breadcrumb a {
            font-size: 0.75rem;
            color: #aaa;
            text-decoration: none;
            letter-spacing: 0.03em;
            transition: color 0.2s;
        }

        .breadcrumb a:hover {
            color: var(--gold-light);
        }

        /* Header */
        .header {
            background: var(--ink);
            padding: 1.5rem 1.5rem 1.25rem;
            text-align: center;
        }

        .header-chinese {
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 1.8rem;
            color: var(--gold-light);
            letter-spacing: 0.1em;
            margin-bottom: 0.3rem;
        }

        .header h1 {
            font-size: 1rem;
            font-weight: 300;
            color: #fff;
            letter-spacing: 0.05em;
            margin-bottom: 0.3rem;
        }

        .header-sub {
            font-size: 0.7rem;
            color: #999;
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* Map container */
        .map-container {
            height: calc(100vh - 180px);
            min-height: 400px;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .map-title {
            font-family: 'Inter', 'Noto Sans SC', system-ui, sans-serif;
            color: var(--ink);
            background: rgba(255, 255, 255, 0.95);
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 280px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .map-title .chinese {
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--gold);
            letter-spacing: 0.1em;
        }
        .map-title .main {
            font-size: 15px;
            font-weight: 600;
            margin-top: 4px;
        }
        .map-title .sub {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 6px;
            line-height: 1.5;
        }

        .legend {
            font-family: 'Inter', system-ui, sans-serif;
            color: var(--ink);
            background: rgba(255, 255, 255, 0.95);
            padding: 14px 16px;
            border-radius: 10px;
            font-size: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            border: 1px solid rgba(0,0,0,0.1);
        }
        .legend-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gold);
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        .legend-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid;
        }
        .legend-line {
            width: 24px;
            height: 3px;
            margin-right: 10px;
            border-radius: 2px;
        }

        .leaflet-popup-content-wrapper {
            background: rgba(255, 255, 255, 0.98);
            color: var(--ink);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .leaflet-popup-tip {
            background: rgba(255, 255, 255, 0.98);
        }
        .leaflet-popup-content {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            font-size: 13px;
            line-height: 1.5;
            margin: 12px 14px;
        }
        .popup-chinese {
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 18px;
            color: var(--gold);
            font-weight: 600;
        }
        .popup-name {
            font-weight: 600;
            margin-top: 2px;
        }
        .popup-desc {
            opacity: 0.7;
            margin-top: 6px;
            font-size: 12px;
        }

        /* Location labels */
        .location-label {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            font-family: 'Noto Sans SC', 'Inter', sans-serif;
            font-weight: 600;
            white-space: nowrap;
        }
        .location-label .label-text {
            background: rgba(255, 255, 255, 0.9);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            border: 1px solid rgba(0,0,0,0.1);
        }
        .location-label .chinese {
            font-size: 14px;
            color: var(--gold);
        }
        .location-label .english {
            font-size: 11px;
            color: var(--ink-light);
            margin-left: 4px;
        }
        .location-label.death .chinese {
            color: var(--gold);
        }
        .location-label.water .chinese {
            color: #2a6a8a;
        }

        /* Footer */
        footer {
            background: var(--ink);
            padding: 1rem 1.5rem;
            text-align: center;
        }

        footer .foot-chinese {
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 0.9rem;
            color: var(--gold-light);
            margin-bottom: 0.2rem;
        }

        footer .foot-title {
            font-size: 0.65rem;
            color: #aaa;
            margin-bottom: 0.2rem;
        }

        footer .foot-term {
            font-size: 0.55rem;
            font-weight: 600;
            color: var(--gold);
            letter-spacing: 0.08em;
        }
    </style>
</head>
<body>
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="../../index.html">&larr; EAST 370</a>
    </nav>

    <!-- Header -->
    <header class="header">
        <div class="header-chinese">屈原流亡路線</div>
        <h1>Qu Yuan's Exile Route (278 BCE)</h1>
        <p class="header-sub">From the fallen capital of Ying through the waterways of Chu to his final destination at the Miluo River</p>
    </header>

    <!-- Map -->
    <div class="map-container">
        <div id="map"></div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="foot-chinese">中國文學與思想</div>
        <div class="foot-title">EAST 370 · Chinese Traditional Literature and Thought</div>
        <div class="foot-term">WINTER 2026</div>
    </footer>

    <script>
        const map = L.map("map", {
            zoomControl: true,
            preferCanvas: true,
            attributionControl: false
        });

        // Light basemap
        L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", {
            subdomains: "abcd",
            maxZoom: 12,
            minZoom: 5
        }).addTo(map);

        // Attribution
        L.control.attribution({
            position: 'bottomright',
            prefix: '© OpenStreetMap © CARTO'
        }).addTo(map);

        // Title control
        const titleControl = L.control({ position: "topleft" });
        titleControl.onAdd = function() {
            const div = L.DomUtil.create("div", "map-title");
            div.innerHTML = `
                <div class="chinese">屈原流亡路線</div>
                <div class="main">Qu Yuan's Exile Route</div>
                <div class="sub">278 BCE — From the fallen capital of Ying through the waterways of Chu to his final destination at the Miluo River</div>
            `;
            return div;
        };
        titleControl.addTo(map);

        // Legend control
        const legendControl = L.control({ position: "bottomleft" });
        legendControl.onAdd = function() {
            const div = L.DomUtil.create("div", "legend");
            div.innerHTML = `
                <div class="legend-title">Legend</div>
                <div class="legend-item">
                    <div class="legend-marker" style="background: #b8860b; border-color: #b8860b;"></div>
                    <span>Capital / City</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker" style="background: #4a90a4; border-color: #4a90a4;"></div>
                    <span>Water Feature</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker" style="background: #daa520; border-color: #8a6a00;"></div>
                    <span>Death Site</span>
                </div>
                <div class="legend-item">
                    <div class="legend-line" style="background: #b8860b;"></div>
                    <span>Exile Route</span>
                </div>
            `;
            return div;
        };
        legendControl.addTo(map);

        // Locations with real coordinates
        const locations = {
            ying: {
                name: "Ying",
                chinese: "郢",
                lat: 30.35,
                lng: 112.24,
                type: "capital",
                desc: "Capital of Chu until 278 BCE. Captured by Qin general Bai Qi.",
                labelOffset: [15, -5]
            },
            jingzhou: {
                name: "Dragon Gate",
                chinese: "龍門",
                lat: 30.32,
                lng: 112.28,
                type: "gate",
                desc: "Eastern gate of Ying. 'I passed through the city gate with a heavy heart.'",
                labelOffset: [15, 5]
            },
            xiaRiver: {
                name: "Xia River",
                chinese: "夏水",
                lat: 30.15,
                lng: 112.60,
                type: "water",
                desc: "Tributary of the Yangtze. 'Following the waters of the Chiang and Hsia, I travelled into exile.'",
                labelOffset: [15, 0]
            },
            yangtze: {
                name: "Yangtze",
                chinese: "江",
                lat: 29.85,
                lng: 113.10,
                type: "water",
                desc: "Main artery of Chu. Simply called 'the River' (江) in the poems.",
                labelOffset: [15, 0]
            },
            dongting: {
                name: "Dongting Lake",
                chinese: "洞庭湖",
                lat: 29.31,
                lng: 112.95,
                type: "water",
                desc: "Great lake of the south. 'South up to the Tung-t'ing lake, and then north again to the River.'",
                labelOffset: [-90, 0]
            },
            miluo: {
                name: "Miluo River",
                chinese: "汨羅江",
                lat: 28.80,
                lng: 113.08,
                type: "death",
                desc: "Site of Qu Yuan's ritual suicide in 278 BCE. Origin of the Dragon Boat Festival.",
                labelOffset: [15, 0]
            }
        };

        // Marker styles by type
        const markerStyles = {
            capital: { radius: 10, color: "#b8860b", weight: 3, fillColor: "#b8860b", fillOpacity: 0.9 },
            gate: { radius: 7, color: "#b8860b", weight: 2, fillColor: "#b8860b", fillOpacity: 0.7 },
            water: { radius: 8, color: "#4a90a4", weight: 2, fillColor: "#4a90a4", fillOpacity: 0.8 },
            death: { radius: 10, color: "#8a6a00", weight: 3, fillColor: "#daa520", fillOpacity: 0.9 }
        };

        // Add markers and labels
        for (const key in locations) {
            const loc = locations[key];
            const style = markerStyles[loc.type];

            // Add circle marker
            const marker = L.circleMarker([loc.lat, loc.lng], style).addTo(map);

            marker.bindPopup(`
                <div class="popup-chinese">${loc.chinese}</div>
                <div class="popup-name">${loc.name}</div>
                <div class="popup-desc">${loc.desc}</div>
            `);

            // Add permanent label
            const labelClass = loc.type === 'death' ? 'location-label death' :
                               loc.type === 'water' ? 'location-label water' : 'location-label';

            L.marker([loc.lat, loc.lng], {
                icon: L.divIcon({
                    className: labelClass,
                    html: `<div class="label-text"><span class="chinese">${loc.chinese}</span><span class="english">${loc.name}</span></div>`,
                    iconSize: [120, 20],
                    iconAnchor: [-loc.labelOffset[0], 10 - loc.labelOffset[1]]
                })
            }).addTo(map);
        }

        // Exile route polyline
        const exileRoute = [
            [30.35, 112.24],  // Ying
            [30.32, 112.28],  // Dragon Gate
            [30.15, 112.60],  // Xia River
            [29.85, 113.10],  // Yangtze
            [29.31, 112.95],  // Dongting
            [28.80, 113.08]   // Miluo
        ];

        L.polyline(exileRoute, {
            weight: 4,
            opacity: 0.8,
            color: "#b8860b",
            dashArray: "12 8",
            lineCap: "round"
        }).addTo(map);

        // Fit bounds to show all markers with padding
        const bounds = L.latLngBounds([
            [28.5, 111.8],
            [30.6, 113.5]
        ]);
        map.fitBounds(bounds, { padding: [50, 50] });
    </script>
</body>
</html>
