<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EAST 370 - Chinese Traditional Literature and Thought</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&family=Noto+Serif+SC&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root { --bg: #f5f5f7; --surface: #fff; --surface-alt: #fafafa; --border: #e5e5e5; --text: #1d1d1f; --text-muted: #86868b; --accent: #8b0000; --accent-light: #fef2f2; }
    body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg); color: var(--text); }
    header { background: var(--surface); border-bottom: 1px solid var(--border); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
    .header-left { display: flex; align-items: center; gap: 16px; }
    .course-title { font-weight: 600; font-size: 15px; }
    .day-nav { display: flex; align-items: center; gap: 6px; }
    .day-nav button { background: none; border: 1px solid var(--border); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; }
    .header-tools { display: flex; gap: 8px; }
    .header-tools button { background: var(--surface-alt); border: 1px solid var(--border); padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 11px; }
    main { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .roster-strip { background: var(--surface); border-radius: 10px; padding: 16px 20px; margin-bottom: 20px; }
    .roster-strip h3 { font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-muted); margin-bottom: 14px; font-weight: 500; }
    .roster-row { display: flex; gap: 14px; overflow-x: auto; padding-bottom: 4px; }
    .student-nameplate {
      display: flex; flex-direction: column; align-items: center; gap: 8px;
      background: linear-gradient(145deg, #fefefe, #f5f5f5);
      padding: 14px 18px 12px;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.8);
      border: 1px solid rgba(0,0,0,0.06);
      min-width: 90px;
      position: relative;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .student-nameplate:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.12), 0 2px 4px rgba(0,0,0,0.08); }
    .student-nameplate::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: linear-gradient(90deg, #8b0000, #a52a2a, #8b0000);
      border-radius: 4px 4px 0 0;
    }
    .student-nameplate img {
      width: 48px; height: 48px; border-radius: 50%; object-fit: cover;
      border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .student-nameplate .name {
      font-size: 13px; font-weight: 600; text-align: center;
      color: var(--text); letter-spacing: 0.3px;
    }
    .student-nameplate .pronouns {
      font-size: 10px; color: var(--text-muted);
      font-style: italic; margin-top: -4px;
    }
    .prep-container { background: var(--surface); border-radius: 12px; overflow: hidden; }
    .prep-header {
      background: linear-gradient(165deg, #4a1c1c 0%, #6b2c2c 40%, #8b3a3a 70%, #9b4a4a 100%);
      color: white; padding: 24px 28px; position: relative; overflow: hidden;
    }
    .prep-header::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text x="50" y="60" text-anchor="middle" font-size="60" fill="rgba(255,255,255,0.03)" font-family="serif">ÈÅì</text></svg>');
      background-position: right 20px top 10px; background-repeat: no-repeat; background-size: 100px;
      pointer-events: none;
    }
    .prep-header .week-theme {
      font-size: 10px; text-transform: uppercase; letter-spacing: 2px;
      color: #f0c060; margin-bottom: 6px; font-weight: 500; position: relative;
    }
    .prep-header h1 {
      font-size: 26px; font-weight: 300; margin-bottom: 6px;
      letter-spacing: 0.5px; position: relative;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }
    .prep-header .date { font-size: 13px; opacity: 0.75; font-weight: 300; position: relative; letter-spacing: 0.3px; }
    .prep-header .ivanhoe {
      display: inline-block; background: rgba(240,192,96,0.2);
      border: 1px solid rgba(240,192,96,0.3);
      padding: 5px 12px; border-radius: 2px; font-size: 11px; margin-top: 12px;
      color: #f0e6d0; position: relative; letter-spacing: 0.3px;
    }
    .prep-header .ivanhoe a { color: #f0e6d0; text-decoration: underline; }
    .prep-body { display: grid; grid-template-columns: 1fr 340px; min-height: 400px; }
    .prep-main { padding: 24px; border-right: 1px solid var(--border); }
    .prep-sidebar { padding: 24px; background: var(--surface-alt); }
    .section-title { font-size: 11px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 12px; font-weight: 600; }
    .reading-card {
      display: block; padding: 16px 18px; margin-bottom: 12px;
      text-decoration: none; color: var(--text);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      position: relative;
    }
    .reading-card:hover { transform: translateY(-2px); }
    .reading-card .type-badge { display: inline-block; font-size: 9px; font-weight: 600; text-transform: uppercase; padding: 3px 8px; border-radius: 3px; margin-bottom: 8px; }
    .reading-card .title { font-size: 14px; font-weight: 600; margin-bottom: 5px; line-height: 1.3; }
    .reading-card .author { font-size: 12px; margin-bottom: 3px; }
    .reading-card .source { font-size: 11px; }
    .reading-card .chinese { font-family: 'Noto Serif SC', serif; font-size: 16px; color: #8b0000; margin-top: 4px; }
    .reading-card.primary {
      background: linear-gradient(135deg, #faf6f0 0%, #f5efe6 50%, #f0ead8 100%);
      border: 1px solid #d4c9b5;
      border-radius: 2px;
      box-shadow: 2px 3px 8px rgba(139,90,43,0.12), inset 0 0 30px rgba(139,90,43,0.03);
    }
    .reading-card.primary:hover { box-shadow: 3px 5px 12px rgba(139,90,43,0.18); }
    .reading-card.primary .type-badge { background: #8b4513; color: #fff; }
    .reading-card.primary .title { font-family: Georgia, 'Times New Roman', serif; }
    .reading-card.primary .author, .reading-card.primary .source { color: #7a6b5a; }
    .reading-card.philosophy {
      background: linear-gradient(135deg, #fff8f0 0%, #fef5ee 50%, #fdf0e6 100%);
      border: 1px solid #e0c9b5;
      border-left: 4px solid #8b0000;
      border-radius: 0;
    }
    .reading-card.philosophy:hover { box-shadow: 0 4px 12px rgba(139,0,0,0.15); }
    .reading-card.philosophy .type-badge { background: #8b0000; color: #fff; }
    .reading-card.buddhist {
      background: linear-gradient(135deg, #f8f5f0 0%, #f5f0e8 50%, #f0ebe0 100%);
      border: 1px solid #d0c8b8;
      border-left: 4px solid #b8860b;
      border-radius: 0;
    }
    .reading-card.buddhist:hover { box-shadow: 0 4px 12px rgba(184,134,11,0.15); }
    .reading-card.buddhist .type-badge { background: #b8860b; color: #fff; }
    .reading-card.poetry {
      background: linear-gradient(135deg, #f5f8f5 0%, #f0f5f0 50%, #e8f0e8 100%);
      border: 1px solid #c0d0c0;
      border-left: 4px solid #2e8b57;
      border-radius: 0;
    }
    .reading-card.poetry:hover { box-shadow: 0 4px 12px rgba(46,139,87,0.15); }
    .reading-card.poetry .type-badge { background: #2e8b57; color: #fff; }
    .web-links { margin-top: 16px; }
    .web-link { display: inline-block; font-size: 11px; background: var(--surface-alt); border: 1px solid var(--border); padding: 6px 10px; border-radius: 6px; margin: 0 6px 6px 0; color: var(--accent); text-decoration: none; }
    .upcoming-card { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 14px; margin-bottom: 16px; }
    .upcoming-card .day-num { font-size: 13px; font-weight: 600; color: var(--accent); }
    .upcoming-card .topic { font-size: 13px; margin-top: 4px; }
    .upcoming-card .date { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
    .notes-box { background: #fffde7; border: 1px solid #fff59d; border-radius: 8px; padding: 14px; font-size: 12px; margin-bottom: 16px; }
    .notes-box.special { background: #fff3e0; border-color: #ffcc80; }
    .assignment-box { background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 14px; margin-bottom: 16px; }
    .assignment-box .label { font-size: 10px; color: #991b1b; text-transform: uppercase; }
    .assignment-box .name { font-size: 14px; font-weight: 600; color: #7f1d1d; }
    .assignment-box .due { font-size: 12px; color: #b91c1c; }
    .no-class-banner { background: #ffebee; color: #c62828; padding: 40px; text-align: center; font-size: 16px; }
    .prep-section { margin-bottom: 20px; }
    .prep-section h3 { font-size: 12px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 10px; letter-spacing: 0.5px; }
    .prep-summary { background: var(--surface-alt); border-radius: 8px; padding: 16px; line-height: 1.6; font-size: 13px; white-space: pre-wrap; }
    .keywords-table { width: 100%; border-collapse: collapse; font-size: 12px; }
    .keywords-table th { background: var(--accent-light); color: var(--accent); padding: 8px; text-align: left; }
    .keywords-table td { padding: 8px; border-bottom: 1px solid var(--border); }
    .passage-card { background: var(--surface-alt); border-left: 3px solid var(--accent); padding: 12px 16px; margin-bottom: 10px; border-radius: 0 6px 6px 0; }
    .passage-card blockquote { font-style: italic; font-size: 13px; line-height: 1.5; margin: 0 0 8px 0; }
    .passage-card .chinese-quote { font-family: 'Noto Serif SC', serif; font-size: 14px; color: #8b0000; margin-bottom: 8px; font-style: normal; }
    .passage-card .source { font-size: 11px; color: var(--text-muted); }
    .sage-badge { display: inline-block; font-size: 9px; background: var(--accent-light); color: var(--accent); padding: 2px 8px; border-radius: 10px; font-weight: 600; margin-left: 8px; }
    .day-selector { position: relative; }
    .day-dropdown { position: absolute; top: 100%; left: 0; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; min-width: 450px; max-height: 450px; overflow-y: auto; display: none; z-index: 200; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
    .day-dropdown.open { display: block; }
    .day-option { padding: 10px 14px; cursor: pointer; font-size: 12px; display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); }
    .day-option:hover { background: var(--surface-alt); }
    .day-option.active { background: var(--accent-light); }
    .day-option.no-class { color: var(--text-muted); font-style: italic; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; }
    .modal-overlay.active { opacity: 1; visibility: visible; }
    .modal { background: var(--surface); border-radius: 12px; width: 400px; }
    .modal-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
    .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; }
    .modal-body { padding: 20px; }
    .timer-display { font-size: 72px; font-weight: 200; text-align: center; padding: 30px 0; font-family: monospace; }
    .timer-controls { display: flex; gap: 10px; justify-content: center; margin-bottom: 16px; }
    .timer-presets { display: flex; gap: 6px; justify-content: center; }
    .btn { padding: 8px 14px; border-radius: 6px; border: none; cursor: pointer; font-size: 12px; }
    .btn-primary { background: var(--accent); color: white; }
    .btn-secondary { background: var(--surface-alt); border: 1px solid var(--border); }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <span class="course-title">EAST 370 ¬∑ Chinese Traditional Literature and Thought</span>
      <div class="day-nav">
        <button onclick="prevDay()">‚Üê</button>
        <div class="day-selector">
          <button onclick="toggleDayDropdown()" style="min-width:120px"><span id="currentDay">Day 1</span></button>
          <div class="day-dropdown" id="dayDropdown"></div>
        </div>
        <button onclick="nextDay()">‚Üí</button>
      </div>
    </div>
    <div class="header-tools">
      <button onclick="openTimerModal()">‚è±Ô∏è Timer</button>
      <button onclick="window.open('https://drive.google.com/drive/u/2/folders/17nwKLGBRbd8Qu-adTAQnBKnPRCaj5CUW','_blank','noopener,noreferrer')">üìñ Ivanhoe</button>
      <button onclick="window.open('https://drive.google.com/file/d/11ji5DMSpxID7tePLmeAV8_ScBTCv41ro/view?usp=drive_link','_blank','noopener,noreferrer')">üìö Birch</button>
      <button onclick="window.open('https://docs.google.com/document/d/1pe6TGFP7j74LkN62yXIgCsXP8-mQsPtPg4SqCZvGILo/edit','_blank','noopener,noreferrer')">üìÑ Syllabus</button>
    </div>
  </header>
  <main>
    <div class="roster-strip">
      <h3>Class Roster</h3>
      <div class="roster-row" id="rosterRow"></div>
    </div>
    <div class="prep-container">
      <div class="prep-header">
        <div class="week-theme" id="weekTheme">Week 1</div>
        <h1 id="dayTitle">Day 1: Introduction</h1>
        <div class="date" id="dayDate"></div>
        <div class="ivanhoe" id="ivanhoeRef" style="display:none"></div>
      </div>
      <div class="prep-body">
        <div class="prep-main" id="prepMain"></div>
        <div class="prep-sidebar" id="prepSidebar"></div>
      </div>
    </div>
  </main>
  <div class="modal-overlay" id="timerModal">
    <div class="modal">
      <div class="modal-header"><h2>Class Timer</h2><button class="modal-close" onclick="closeTimerModal()">√ó</button></div>
      <div class="modal-body">
        <div class="timer-display" id="timerDisplay">10:00</div>
        <div class="timer-controls">
          <button class="btn btn-primary" onclick="startTimer()">‚ñ∂ Start</button>
          <button class="btn btn-secondary" onclick="pauseTimer()">‚è∏ Pause</button>
          <button class="btn btn-secondary" onclick="resetTimer()">‚Ü∫ Reset</button>
        </div>
        <div class="timer-presets">
          <button class="btn btn-secondary" onclick="setTimer(5)">5m</button>
          <button class="btn btn-secondary" onclick="setTimer(10)">10m</button>
          <button class="btn btn-secondary" onclick="setTimer(15)">15m</button>
          <button class="btn btn-secondary" onclick="setTimer(20)">20m</button>
        </div>
      </div>
    </div>
  </div>
<script>
// STUDENTS - Update this with your EAST 370 roster
var students = [];

var days = [];

var currentDayIndex = 0;
var timerInterval = null;
var timerSeconds = 600;

function escapeHtml(value) {
  return String(value == null ? "" : value)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

function localIsoDate() {
  var now = new Date();
  var year = now.getFullYear();
  var month = String(now.getMonth() + 1).padStart(2, "0");
  var day = String(now.getDate()).padStart(2, "0");
  return year + "-" + month + "-" + day;
}

async function loadStudents() {
  try {
    var response = await fetch("students.json");
    if (!response.ok) return;
    var payload = await response.json();
    if (payload && Array.isArray(payload.students)) {
      students = payload.students;
    }
  } catch (e) {
    // Optional file; fallback to inline list if missing.
  }
}

async function loadDays() {
  try {
    var response = await fetch("prep/days.json");
    if (!response.ok) return;
    var payload = await response.json();
    if (payload && Array.isArray(payload.days)) {
      days = payload.days;
    }
  } catch (e) {
    // Optional file; fallback to inline list if present.
  }
}

function renderRoster() {
  var strip = document.querySelector(".roster-strip");
  var html = "";
  if (students.length === 0) {
    strip.style.display = "none";
    document.getElementById("rosterRow").innerHTML = "";
    return;
  }
  strip.style.display = "block";
  for (var i = 0; i < students.length; i++) {
    var s = students[i];
    var displayName = escapeHtml(s.preferredName || s.firstName || "");
    var pronouns = escapeHtml(s.pronouns || "");
    var initial = (displayName || "?").charAt(0) || "?";
    html += '<div class="student-nameplate">';
    html += '<img src="' + escapeHtml(s.photo || "") + '" onerror="this.src=\'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><circle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%23ddd%22/><text x=%2250%22 y=%2260%22 text-anchor=%22middle%22 font-size=%2240%22 fill=%22%23999%22>' + initial + '</text></svg>\'">';
    html += '<div class="name">' + displayName + '</div>';
    if (s.pronouns) html += '<div class="pronouns">' + pronouns + '</div>';
    html += '</div>';
  }
  document.getElementById("rosterRow").innerHTML = html;
}

function formatDate(d) {
  var dt = new Date(d + "T12:00:00");
  return dt.toLocaleDateString("en-US", {month: "short", day: "numeric"});
}

function formatFullDate(d) {
  var dt = new Date(d + "T12:00:00");
  return dt.toLocaleDateString("en-US", {weekday: "long", month: "long", day: "numeric", year: "numeric"});
}

function initDropdown() {
  var html = "";
  for (var i = 0; i < days.length; i++) {
    var p = days[i];
    var cls = "day-option";
    if (i === currentDayIndex) cls += " active";
    if (p.noClass) cls += " no-class";
    var label = p.day ? "Day " + p.day + ": " : "";
    label += p.topic.length > 40 ? p.topic.substring(0, 40) + "..." : p.topic;
    html += '<div class="' + cls + '" onclick="loadDay(' + i + ')">';
    html += '<span>' + label + '</span>';
    html += '<span class="date">' + p.dayOfWeek + ' ' + formatDate(p.date) + '</span>';
    html += '</div>';
  }
  document.getElementById("dayDropdown").innerHTML = html;
}

function loadDay(i) {
  if (i < 0 || i >= days.length) return;
  currentDayIndex = i;
  var p = days[i];

  document.getElementById("currentDay").textContent = p.day ? "Day " + p.day : p.topic;
  document.getElementById("weekTheme").textContent = "Week " + p.week + " ¬∑ " + (p.theme || "");
  document.getElementById("dayTitle").textContent = p.day ? "Day " + p.day + ": " + p.topic : p.topic;
  document.getElementById("dayDate").textContent = formatFullDate(p.date);

  var iv = document.getElementById("ivanhoeRef");
  if (p.ivanhoe) {
    // Find the first philosophy reading's URL for this day
    var ivUrl = "https://drive.google.com/drive/u/2/folders/17nwKLGBRbd8Qu-adTAQnBKnPRCaj5CUW";
    for (var r = 0; r < p.readings.length; r++) {
      if (p.readings[r].type === "philosophy" && p.readings[r].url) {
        ivUrl = p.readings[r].url;
        break;
      }
    }
    iv.innerHTML = 'üìñ <a href="' + escapeHtml(ivUrl) + '" target="_blank" rel="noopener noreferrer" style="color:#f0e6d0;text-decoration:underline;">Ivanhoe: ' + escapeHtml(p.ivanhoe) + '</a>';
    iv.style.display = "inline-block";
  } else {
    iv.style.display = "none";
  }

  renderMain(p);
  renderSidebar(p, i);

  var opts = document.querySelectorAll(".day-option");
  for (var j = 0; j < opts.length; j++) {
    opts[j].className = opts[j].className.replace(" active", "");
    if (j === i) opts[j].className += " active";
  }
  document.getElementById("dayDropdown").className = "day-dropdown";
}

function renderMain(p) {
  var m = document.getElementById("prepMain");

  if (p.noClass) {
    m.innerHTML = '<div class="no-class-banner">üö´ No Class ‚Äî ' + escapeHtml(p.topic) + '</div>';
    return;
  }

  var h = "";

  // Readings
  if (p.readings && p.readings.length > 0) {
    h += '<div class="section-title">Today\'s Readings</div>';
    for (var i = 0; i < p.readings.length; i++) {
      var r = p.readings[i];
      var tc = r.type || "philosophy";
      h += '<a class="reading-card ' + tc + '" href="' + escapeHtml(r.url || '#') + '" target="_blank" rel="noopener noreferrer">';
      h += '<div class="type-badge">' + escapeHtml(tc.charAt(0).toUpperCase() + tc.slice(1)) + '</div>';
      h += '<div class="title">' + escapeHtml(r.title) + '</div>';
      if (r.titleChinese) h += '<div class="chinese">' + escapeHtml(r.titleChinese) + '</div>';
      if (r.author) h += '<div class="author">' + escapeHtml(r.author) + '</div>';
      if (r.source || r.pages) {
        h += '<div class="source">' + escapeHtml(r.source || "") + (r.pages ? " ¬∑ pp. " + escapeHtml(r.pages) : "") + '</div>';
      }
      h += '</a>';
    }
  }

  if (!h) h = '<p style="color:var(--text-muted);padding:20px">No readings for this day.</p>';
  m.innerHTML = h;
}

function renderSidebar(p, i) {
  var s = document.getElementById("prepSidebar");
  var h = "";

  if (p.notes) {
    h += '<div class="section-title">Notes</div>';
    h += '<div class="notes-box">' + escapeHtml(p.notes) + '</div>';
  }

  if (p.assignment) {
    h += '<div class="assignment-box">';
    h += '<div class="label">üìå Assignment Due</div>';
    h += '<div class="name">' + escapeHtml(p.assignment.name) + '</div>';
    h += '<div class="due">' + p.assignment.dueDay + ', ' + formatDate(p.assignment.due) + '</div>';
    h += '</div>';
  }

  var ni = i + 1;
  while (ni < days.length && days[ni].noClass) ni++;
  var nx = days[ni];

  h += '<div class="section-title">Coming Up Next</div>';
  if (nx) {
    h += '<div class="upcoming-card">';
    h += '<div class="day-num">' + (nx.day ? "Day " + nx.day : nx.topic) + '</div>';
    h += '<div class="topic">' + nx.topic + '</div>';
    h += '<div class="date">' + nx.dayOfWeek + ', ' + formatDate(nx.date) + '</div>';
    h += '</div>';
  } else {
    h += '<div class="upcoming-card"><div class="topic">End of Course</div></div>';
  }

  s.innerHTML = h;
}

function prevDay() { loadDay(currentDayIndex - 1); }
function nextDay() { loadDay(currentDayIndex + 1); }

function toggleDayDropdown() {
  var dd = document.getElementById("dayDropdown");
  dd.className = dd.className.indexOf("open") >= 0 ? "day-dropdown" : "day-dropdown open";
}

function updateTimerDisplay() {
  var m = Math.floor(timerSeconds / 60);
  var s = timerSeconds % 60;
  document.getElementById("timerDisplay").textContent =
    (m < 10 ? "0" : "") + m + ":" + (s < 10 ? "0" : "") + s;
}

function startTimer() {
  if (timerInterval) return;
  timerInterval = setInterval(function() {
    timerSeconds--;
    updateTimerDisplay();
    if (timerSeconds <= 0) {
      clearInterval(timerInterval);
      timerInterval = null;
      alert("Time!");
    }
  }, 1000);
}

function pauseTimer() {
  clearInterval(timerInterval);
  timerInterval = null;
}

function resetTimer() {
  pauseTimer();
  timerSeconds = 600;
  updateTimerDisplay();
}

function setTimer(m) {
  pauseTimer();
  timerSeconds = m * 60;
  updateTimerDisplay();
}

function openTimerModal() {
  document.getElementById("timerModal").className = "modal-overlay active";
}

function closeTimerModal() {
  document.getElementById("timerModal").className = "modal-overlay";
}

function findToday() {
  var t = localIsoDate();
  for (var i = 0; i < days.length; i++) {
    if (days[i].date === t) return i;
    if (days[i].date > t) return i;
  }
  return days.length - 1;
}

document.addEventListener("click", function(e) {
  if (!e.target.closest(".day-selector")) {
    document.getElementById("dayDropdown").className = "day-dropdown";
  }
});

document.getElementById("timerModal").addEventListener("click", function(e) {
  if (e.target === this) closeTimerModal();
});

window.onload = async function() {
  await loadStudents();
  await loadDays();
  renderRoster();
  if (!days.length) {
    document.getElementById("currentDay").textContent = "No data";
    document.getElementById("dayTitle").textContent = "No schedule loaded";
    document.getElementById("dayDate").textContent = "";
    document.getElementById("weekTheme").textContent = "";
    document.getElementById("prepMain").innerHTML = '<p style="color:var(--text-muted);padding:20px">No schedule data found. Add <code>prep/days.json</code>.</p>';
    document.getElementById("prepSidebar").innerHTML = "";
    updateTimerDisplay();
    return;
  }
  initDropdown();
  loadDay(findToday());
  updateTimerDisplay();
};
</script>
</body>
</html>
